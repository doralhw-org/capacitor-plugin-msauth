{"version":3,"file":"plugin.js","sources":["esm/web.js","esm/index.js"],"sourcesContent":["import { PublicClientApplication } from '@azure/msal-browser';\nimport { WebPlugin } from '@capacitor/core';\nconst TENANT_PATTERN = /^[a-zA-Z0-9][a-zA-Z0-9.-]*$/;\nexport class MsAuth extends WebPlugin {\n    async login(options) {\n        const context = await this.createContext(options);\n        try {\n            if (options.interactionType === 'redirect') {\n                const redirectResult = await context.handleRedirectPromise();\n                if (redirectResult) {\n                    return {\n                        accessToken: redirectResult.accessToken,\n                        idToken: redirectResult.idToken,\n                        scopes: redirectResult.scopes,\n                    };\n                }\n            }\n            return await this.acquireTokenSilently(context, options.scopes).catch(() => this.acquireTokenInteractively(context, options));\n        }\n        catch (error) {\n            console.error('MSAL: Error occurred while logging in', error);\n            throw error;\n        }\n    }\n    async logout(options) {\n        const context = await this.createContext(options);\n        if (options.interactionType === 'redirect') {\n            await context.handleRedirectPromise();\n        }\n        if (!context.getAllAccounts()[0]) {\n            return Promise.reject(new Error('Nothing to sign out from.'));\n        }\n        if (options.interactionType === 'redirect') {\n            return context.logoutRedirect();\n        }\n        return context.logoutPopup();\n    }\n    logoutAll(options) {\n        return this.logout(options);\n    }\n    async createContext(options) {\n        if (options.authorityUrl && !options.authorityUrl.startsWith('https://')) {\n            throw new Error('authorityUrl must use HTTPS.');\n        }\n        if (!options.authorityUrl && options.tenant) {\n            if (!TENANT_PATTERN.test(options.tenant)) {\n                throw new Error('Invalid tenant specified.');\n            }\n        }\n        const config = {\n            auth: {\n                clientId: options.clientId,\n                authority: options.authorityUrl ?? `https://login.microsoftonline.com/${options.tenant ?? 'common'}`,\n                knownAuthorities: options.knownAuthorities,\n                redirectUri: options.redirectUri ?? this.getCurrentUrl(),\n            },\n            cache: {\n                cacheLocation: options.interactionType === 'redirect' ? 'localStorage' : 'sessionStorage',\n            },\n        };\n        return await PublicClientApplication.createPublicClientApplication(config);\n    }\n    getCurrentUrl() {\n        return window.location.href.split(/[?#]/)[0];\n    }\n    async acquireTokenInteractively(context, options) {\n        const prompt = options.prompt ?? 'select_account';\n        if (options.interactionType === 'redirect') {\n            await context.acquireTokenRedirect({\n                scopes: options.scopes,\n                prompt,\n            });\n            // acquireTokenRedirect navigates away; this promise never resolves in practice.\n            return new Promise(() => { });\n        }\n        const { accessToken, idToken } = await context.acquireTokenPopup({\n            scopes: options.scopes,\n            prompt,\n        });\n        return { accessToken, idToken, scopes: options.scopes };\n    }\n    async acquireTokenSilently(context, scopes) {\n        const { accessToken, idToken } = await context.acquireTokenSilent({\n            scopes,\n            account: context.getAllAccounts()[0],\n        });\n        return { accessToken, idToken, scopes };\n    }\n}\n//# sourceMappingURL=web.js.map","import { registerPlugin } from '@capacitor/core';\nimport { MsAuth } from './web';\nconst MsAuthPlugin = registerPlugin('MsAuthPlugin', {\n    web: () => new MsAuth(),\n});\nexport * from './definitions';\nexport { MsAuthPlugin };\n//# sourceMappingURL=index.js.map"],"names":["WebPlugin","PublicClientApplication","registerPlugin"],"mappings":"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"}